<!DOCTYPE html>
<html>
<head>
  <title>Time Donation Portal</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    input, textarea {
      width: 95%;
      margin-bottom: 10px;
      padding: 6px;
    }
    button {
      padding: 8px 16px;
    }
  </style>
</head>
<body>

<h2>Login</h2>

<div id="g_id_onload"
     data-client_id="656602297566-jeksmvl1n1uef5mq8h958gducrrkga5n.apps.googleusercontent.com"
     data-callback="handleLogin">
</div>

<div class="g_id_signin"></div>

<div id="app"></div>

<script>
const BACKEND_URL =
  "https://script.google.com/macros/s/AKfycbwEmwbh6HdM1TeAmmHo-f-Ht31cnOLgEGFjc1p2KPZgpiSS7xMUgTi4CXfmygiYbe8IHw/exec";

let currentUser = {};

function handleLogin(response) {
  fetch(BACKEND_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify({
      action: "login",
      id_token: response.credential
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.error) return alert(data.error);

    currentUser = data;

    if (data.role === "iitb") {
      renderIITBForm();
    } else {
      renderNonIITBForm();
    }
  });
}

/* =========================
   IITB FORM RENDERING
   ========================= */
function renderIITBForm() {
  document.getElementById("app").innerHTML = `
    <h3>Signed in as ${currentUser.email}</h3>
    <h3>IITB Alumni Contribution Form</h3>

    ${commonFieldsHTML()}

    <button onclick="submitForm('iitb')">Submit IITB Form</button>
  `;
}

/* =========================
   NON-IITB FORM RENDERING
   ========================= */
function renderNonIITBForm() {
  document.getElementById("app").innerHTML = `
    <h3>Signed in as ${currentUser.email}</h3>
    <h3>General Contributor Form</h3>

    ${commonFieldsHTML()}

    <button onclick="submitForm('non-iitb')">Submit General Form</button>
  `;
}

/* =========================
   COMMON FIELDS (REUSED)
   ========================= */
function commonFieldsHTML() {
  return `
    <input id="name" placeholder="Name of Alum">
    <input id="batch" placeholder="Batch / Department">
    <input id="email" placeholder="Email Address">
    <input id="mobile" placeholder="Mobile Number">
    <input id="domain" placeholder="Professional Domain">
    <input id="expertise" placeholder="Other areas of interest / expertise">
    <input id="contribution" placeholder="Area of Contribution (Skill / Mentorship / Guidance)">
    <textarea id="description" placeholder="Description of Time Deposit"></textarea>
    <input id="hours" placeholder="Estimated Hours You Wish to Deposit">
    <input id="availability" placeholder="Preferred Time Slots / Availability">
    <textarea id="notes" placeholder="Any Additional Notes"></textarea>
  `;
}

/* =========================
   SUBMIT
   ========================= */
function submitForm(role) {
  const payload = {
    action: "submit",
    role: role,
    name: document.getElementById("name").value,
    batch: document.getElementById("batch").value,
    email: document.getElementById("email").value,
    mobile: document.getElementById("mobile").value,
    domain: document.getElementById("domain").value,
    expertise: document.getElementById("expertise").value,
    contribution: document.getElementById("contribution").value,
    description: document.getElementById("description").value,
    hours: document.getElementById("hours").value,
    availability: document.getElementById("availability").value,
    notes: document.getElementById("notes").value
  };

  fetch(BACKEND_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(() => {alert("Response Saved successfully");
    if (role === "iitb") {
      renderIITBForm();
    } else {
      renderNonIITBForm();
    }







   
  });
}
</script>

</body>
</html>
