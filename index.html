<!DOCTYPE html>
<html>
<head>
  <title>Time Donation Portal</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 0;
    }

    /* =========================
       LOGIN BOX
       ========================= */
    #login-container {
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #login-box {
      background: #ffffff;
      padding: 30px 40px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      text-align: center;
      width: 360px;
    }

    #login-box h2 {
      margin-bottom: 20px;
    }

    /* =========================
       FORM CONTAINER
       ========================= */
    #app {
      max-width: 900px;
      margin: 40px auto;
      background: #ffffff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    h3 {
      margin-top: 0;
      color: #333;
    }

    .signed-in {
      color: #555;
      margin-bottom: 20px;
    }

    /* =========================
       INPUTS
       ========================= */
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      box-sizing: border-box;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #4f46e5;
    }

    /* =========================
       BUTTON
       ========================= */
    button {
      background: #4f46e5;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 15px;
      cursor: pointer;
    }

    button:hover {
      background: #4338ca;
    }
  </style>
</head>

<body>

<!-- =========================
     LOGIN SECTION
     ========================= -->
<div id="login-container">
  <div id="login-box">
    <h2>Login</h2>

    <div id="g_id_onload"
         data-client_id="656602297566-jeksmvl1n1uef5mq8h958gducrrkga5n.apps.googleusercontent.com"
         data-callback="handleLogin">
    </div>

    <div class="g_id_signin"></div>
  </div>
</div>

<!-- =========================
     FORM SECTION
     ========================= -->
<div id="app"></div>

<script>
const BACKEND_URL =
  "https://script.google.com/macros/s/AKfycbwEmwbh6HdM1TeAmmHo-f-Ht31cnOLgEGFjc1p2KPZgpiSS7xMUgTi4CXfmygiYbe8IHw/exec";

let currentUser = {};

/* =========================
   LOGIN HANDLER
   ========================= */
function handleLogin(response) {
  fetch(BACKEND_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify({
      action: "login",
      id_token: response.credential
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.error) return alert(data.error);

    currentUser = data;

    // ðŸ”¥ Hide login section
    document.getElementById("login-container").style.display = "none";

    if (data.role === "iitb") {
      renderIITBForm();
    } else {
      renderNonIITBForm();
    }
  });
}

/* =========================
   IITB FORM
   ========================= */
function renderIITBForm() {
  document.getElementById("app").innerHTML = `
    <p class="signed-in">Signed in as <b>${currentUser.email}</b></p>
    <h3>IITB Alumni Contribution Form</h3>

    ${commonFieldsHTML()}

    <button onclick="submitForm('iitb')">Submit</button>
  `;
}

/* =========================
   NON-IITB FORM
   ========================= */
function renderNonIITBForm() {
  document.getElementById("app").innerHTML = `
    <p class="signed-in">Signed in as <b>${currentUser.email}</b></p>
    <h3>General Contributor Form</h3>

    ${commonFieldsHTML()}

    <button onclick="submitForm('non-iitb')">Submit</button>
  `;
}

/* =========================
   COMMON FIELDS
   ========================= */
function commonFieldsHTML() {
  return `
    <input id="name" placeholder="Name of Alum">
    <input id="batch" placeholder="Batch / Department">
    <input id="email" value="${currentUser.email}" readonly>
    <input id="mobile" placeholder="Mobile Number">
    <input id="domain" placeholder="Professional Domain">
    <input id="expertise" placeholder="Other areas of interest / expertise">
    <input id="contribution" placeholder="Area of Contribution (Skill / Mentorship / Guidance)">
    <textarea id="description" placeholder="Description of Time Deposit"></textarea>
    <input id="hours" placeholder="Estimated Hours You Wish to Deposit">
    <input id="availability" placeholder="Preferred Time Slots / Availability">
    <textarea id="notes" placeholder="Any Additional Notes"></textarea>
  `;
}

/* =========================
   SUBMIT
   ========================= */
function submitForm(role) {
  const payload = {
    action: "submit",
    role,
    name: name.value,
    batch: batch.value,
    email: email.value,
    mobile: mobile.value,
    domain: domain.value,
    expertise: expertise.value,
    contribution: contribution.value,
    description: description.value,
    hours: hours.value,
    availability: availability.value,
    notes: notes.value
  };

  fetch(BACKEND_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(() => {
    alert("Response saved successfully");

    // reset form
    role === "iitb" ? renderIITBForm() : renderNonIITBForm();
  });
}
</script>

</body>
</html>
